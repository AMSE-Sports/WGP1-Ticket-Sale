<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WGP#1 — Visitor & Staff Registration (Fixed Consent & Country)</title>
  <style>
    :root { --primary:#f37021; --border:#ececec; --ok:#16a34a; --err:#dc2626; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; background:#fafafa; color:#111; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; }
    .card { border:1px solid var(--border); border-radius:16px; overflow:hidden; background:#fff; box-shadow:0 10px 24px -18px rgba(0,0,0,.25); }
    .head { padding:14px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .body { padding:16px; }
    .row { display:grid; gap:12px; grid-template-columns:1fr; }
    @media (min-width:760px) { .row.two { grid-template-columns:1fr 1fr; } }
    label { font-weight:700; font-size:13px; display:block; margin-bottom:6px; }
    input, select { width:100%; padding:12px; border-radius:12px; border:1px solid var(--border); outline:none; }
    input:focus, select:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(243,112,33,.2); }
    .btn { display:inline-flex; gap:10px; align-items:center; font-weight:800; border:0; padding:16px 20px; border-radius:16px; cursor:pointer; }
    .btn.primary { background:var(--primary); color:#fff; box-shadow:0 10px 24px -16px rgba(243,112,33,.85); }
    .btn.dark { background:#111; color:#fff; }
    .btn.wide { width:100%; justify-content:center; font-size:16px; }
    .thank { text-align:center; padding:40px 20px; color:#fff; background:linear-gradient(135deg, var(--primary), #ff8c4a); }
    .consent-check { display:flex; gap:10px; align-items:flex-start; }
    .consent-check input { margin-top: 4px; flex: 0 0 auto; }
    .consent-text { line-height:1.5; }
    .consent-text strong { display:block; margin-bottom:6px; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="wrap">

    <section id="v1" class="card" style="margin-top:16px;">
      <div class="head"><h2 style="margin:0;">ส่วนที่ 1 — ผู้ชม (Visitor)</h2></div>
      <form class="body" id="visitor-form" autocomplete="on">
        <div class="row">
          <div>
            <label>อีเมล *</label>
            <input id="v-email" type="email" required placeholder="name@example.com" autocomplete="email">
          </div>
        </div>
        <div class="row two">
          <div><label>ชื่อจริง *</label><input id="v-first" required autocomplete="given-name"></div>
          <div><label>นามสกุล *</label><input id="v-last" required autocomplete="family-name"></div>
        </div>
        <div class="row two">
          <div>
            <label>เพศ *</label>
            <select id="v-gender" required>
              <option value="">— เลือกเพศ —</option>
              <option value="male">ชาย</option><option value="female">หญิง</option><option value="unspecified">ไม่ระบุ</option>
            </select>
          </div>
          <div>
            <label>อายุ *</label>
            <select id="v-age" required>
              <option value="">— เลือกช่วงอายุ —</option>
              <option>ต่ำกว่า 18 ปี</option><option>18-25 ปี</option><option>26-40 ปี</option><option>41-60 ปี</option><option>60 ปีขึ้นไป</option>
            </select>
          </div>
        </div>
        <div class="row two">
          <div>
            <label>ประเทศที่อาศัย *</label>
            <select id="v-country" required></select>
          </div>
          <div>
            <label>เมืองที่อาศัย *</label>
            <input id="v-city" required pattern="[\u0E00-\u0E7F a-zA-Z-]+" placeholder="เช่น Pattaya / กรุงเทพฯ">
            <div class="sub">รองรับอักษรไทย/อังกฤษและช่องว่างเท่านั้น</div>
          </div>
        </div>
        <div class="row" id="thai-province-row" style="display:none">
          <div>
            <label>จังหวัดที่อาศัยในประเทศไทย *</label>
            <select id="v-province"></select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>ความยินยอม *</label>
            <div class="consent-check">
              <input type="checkbox" id="v-consent" required aria-label="consent checkbox">
              <div class="consent-text">
                <strong>ฉันได้อ่านและยินยอมตามเงื่อนไขข้างต้น • I have read and consent</strong>
                <em>EN:</em> By attending the WGP#1 Waterjet World Cup 2025, which includes live broadcasting and global media coverage, you grant the event organizers and their partners the right to photograph, film, and record your image and voice for use in promotions, advertising, live streams, and other media—without the need for further consent or compensation. Entering the event area constitutes full and unconditional consent. If you do not wish to appear in such media, please avoid camera zones or broadcast areas.<br>
                <em>TH:</em> ในการเข้าชมการแข่งขัน WGP#1 Waterjet World Cup 2025 ซึ่งมีการถ่ายทอดสดและเผยแพร่สู่สาธารณะทั่วโลก ท่านยินยอมให้ผู้จัดงานและพันธมิตร สามารถบันทึกภาพนิ่ง วิดีโอ และเสียงของท่าน เพื่อใช้ในสื่อประชาสัมพันธ์ โฆษณา ถ่ายทอดสด และสื่ออื่น ๆ โดยไม่ต้องขออนุญาตหรือจ่ายค่าตอบแทนใด ๆ เพิ่มเติม การเข้าสู่พื้นที่จัดงาน ถือเป็นการให้ความยินยอมโดยสมบูรณ์ หากไม่ประสงค์ให้ถูกบันทึกภาพ โปรดหลีกเลี่ยงบริเวณกล้องหรือพื้นที่ถ่ายทอดสด
              </div>
            </div>
          </div>
        </div>
        <button class="btn primary wide" type="submit">ยืนยันข้อมูลผู้ชม • Confirm Visitor Details</button>
      </form>
    </section>

    <section id="v2" class="card hidden" style="margin-top:16px;">
      <div class="thank">
        <h2>THANK YOU!</h2>
        <p>ขอบคุณที่ร่วมเป็นส่วนหนึ่งของการแข่งขันระดับโลกครั้งนี้ — ขอให้คุณสนุกกับประสบการณ์สุดมันส์!</p>
      </div>
      <div class="body" style="text-align:center">
        <button class="btn dark" id="to-staff">ดำเนินการต่อสำหรับเจ้าหน้าที่</button>
      </div>
    </section>

    <section id="v3" class="card hidden" style="margin-top:16px;">
      <div class="head"><h2 style="margin:0;">ส่วนที่ 2 — เจ้าหน้าที่ (Staff)</h2></div>
      <form class="body" id="staff-form" autocomplete="off">
        <div class="row two">
          <div>
            <label>เจ้าหน้าที่ *</label>
            <select id="s-staff" required>
              <option value="">— เลือกเจ้าหน้าที่ —</option>
              <option>เจ้าหน้าที่ A</option><option>เจ้าหน้าที่ B</option><option>เจ้าหน้าที่ C</option>
              <option>เจ้าหน้าที่ D</option><option>เจ้าหน้าที่ E</option><option>เจ้าหน้าที่ F</option>
            </select>
          </div>
          <div>
            <label>ตั๋วประเภท *</label>
            <select id="s-ticket" required>
              <option value="">— เลือกประเภทตั๋ว —</option>
              <option value="250-17" data-price="250">250฿ - Wed 17</option>
              <option value="250-18" data-price="250">250฿ - Thu 18</option>
              <option value="250-19" data-price="250">250฿ - Fri 19</option>
              <option value="350-20" data-price="350">350฿ - Sat 20</option>
              <option value="350-21" data-price="350">350฿ - Sun 21</option>
              <option value="400-wed-fri" data-price="400">400฿ - Weekday (Wed-Fri)</option>
              <option value="500-weekend" data-price="500">500฿ - Pro Weekend (Sat-Sun)</option>
              <option value="750-all" data-price="750">750฿ - All Event</option>
            </select>
          </div>
        </div>
        <div class="row two">
          <div><label>จำนวนตั๋วที่ซื้อ *</label><input id="s-qty" type="number" min="1" step="1" required></div>
          <div><label>ยอดชำระเงิน (THB) *</label><input id="s-amount" type="number" min="0" step="1" required></div>
        </div>
        <div class="row">
          <div>
            <label>ช่องทางการชำระ *</label>
            <label style="margin-right:12px;"><input type="radio" name="pay" value="เงินสด" required> เงินสด</label>
            <label><input type="radio" name="pay" value="โอนจ่าย"> โอนจ่าย</label>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn primary" id="finalize" type="submit">Finalize Registration</button>
          <button class="btn dark" id="finalize-fallback" type="button">ส่งแบบสำรอง (HTML POST)</button>
        </div>

        <form id="fallback-form" action="{FORMSPREE_ENDPOINT}" method="POST" class="hidden">
          <input type="hidden" name="submittedAt" id="f-submittedAt">
          <input type="hidden" name="visitor_email" id="f-v-email">
          <input type="hidden" name="visitor_firstName" id="f-v-first">
          <input type="hidden" name="visitor_lastName" id="f-v-last">
          <input type="hidden" name="visitor_gender" id="f-v-gender">
          <input type="hidden" name="visitor_ageRange" id="f-v-age">
          <input type="hidden" name="visitor_country" id="f-v-country">
          <input type="hidden" name="visitor_city" id="f-v-city">
          <input type="hidden" name="visitor_thaiProvince" id="f-v-province">
          <input type="hidden" name="visitor_source" id="f-v-source">
          <input type="hidden" name="visitor_consent" id="f-v-consent">
          <input type="hidden" name="staff_staffName" id="f-s-staff">
          <input type="hidden" name="staff_ticketType" id="f-s-ticket">
          <input type="hidden" name="staff_ticketQty" id="f-s-qty">
          <input type="hidden" name="staff_amountPaid" id="f-s-amount">
          <input type="hidden" name="staff_payMethod" id="f-s-pay">
        </form>
      </form>
    </section>

    <section id="v4" class="card hidden" style="margin-top:16px;">
      <div class="thank" style="background:linear-gradient(135deg,#16a34a,#4ade80)">
        <h2>COMPLETE ✅</h2>
        <p>ดำเนินการเสร็จสิ้นแล้ว — พร้อมรับผู้ชมคนถัดไป</p>
      </div>
      <div class="body" style="text-align:center">
        <button class="btn primary" id="back-to-start">กลับไปเริ่มใหม่</button>
      </div>
    </section>
  </div>

<script>
const FORMSPREE_ENDPOINT = "{FORMSPREE_ENDPOINT}";

// Countries + Provinces (no template literals to avoid placeholder bug)
const COUNTRIES = ["Thailand","Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Cambodia","Canada","Chile","China","Colombia","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Dominican Republic","Ecuador","Egypt","Estonia","Finland","France","Germany","Greece","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kenya","Kuwait","Laos","Latvia","Lebanon","Lithuania","Luxembourg","Malaysia","Maldives","Mexico","Monaco","Mongolia","Morocco","Myanmar","Nepal","Netherlands","New Zealand","Nigeria","Norway","Oman","Pakistan","Philippines","Poland","Portugal","Qatar","Romania","Russia","Saudi Arabia","Singapore","Slovakia","Slovenia","South Africa","South Korea","Spain","Sri Lanka","Sweden","Switzerland","Taiwan","Turkey","Ukraine","United Arab Emirates","United Kingdom","United States","Vietnam","Zimbabwe"];
const THAI_PROVINCES = ["กรุงเทพมหานคร","กระบี่","กาญจนบุรี","กาฬสินธุ์","กำแพงเพชร","ขอนแก่น","จันทบุรี","ฉะเชิงเทรา","ชลบุรี","ชัยนาท","ชัยภูมิ","ชุมพร","เชียงราย","เชียงใหม่","ตรัง","ตราด","ตาก","นครนายก","นครปฐม","นครพนม","นครราชสีมา","นครศรีธรรมราช","นครสวรรค์","นนทบุรี","นราธิวาส","น่าน","บึงกาฬ","บุรีรัมย์","ปทุมธานี","ประจวบคีรีขันธ์","ปราจีนบุรี","ปัตตานี","พระนครศรีอยุธยา","พังงา","พัทลุง","พิจิตร","พิษณุโลก","เพชรบุรี","เพชรบูรณ์","แพร่","พะเยา","ภูเก็ต","มหาสารคาม","มุกดาหาร","แม่ฮ่องสอน","ยโสธร","ยะลา","ร้อยเอ็ด","ระนอง","ระยอง","ราชบุรี","ลพบุรี","ลำปาง","ลำพูน","ศรีสะเกษ","สกลนคร","สงขลา","สตูล","สมุทรปราการ","สมุทรสงคราม","สมุทรสาคร","สระแก้ว","สระบุรี","สิงห์บุรี","สุโขทัย","สุพรรณบุรี","สุราษฎร์ธานี","สุรินทร์","หนองคาย","หนองบัวลำภู","อ่างทอง","อำนาจเจริญ","อุดรธานี","อุตรดิตถ์","อุทัยธานี","อุบลราชธานี"];

function show(id){["v1","v2","v3","v4"].forEach(i=>document.getElementById(i).classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); window.scrollTo({top:0,behavior:'smooth'});}

document.addEventListener('DOMContentLoaded', function(){
  // Country options (string concat to avoid {x} issue)
  var c = document.getElementById('v-country');
  var opts = '<option value="">— เลือกประเทศ —</option>';
  for (var i=0;i<COUNTRIES.length;i++){ opts += '<option>' + COUNTRIES[i] + '</option>'; }
  c.innerHTML = opts;
  c.value = 'Thailand';

  // Province options
  var pr = document.getElementById('v-province');
  var provOpts = '';
  for (var j=0;j<THAI_PROVINCES.length;j++){ provOpts += '<option>' + THAI_PROVINCES[j] + '</option>'; }
  pr.innerHTML = provOpts;

  var row = document.getElementById('thai-province-row');
  function toggleProv(){ var isTH = (c.value==='Thailand' || c.value==='ไทย'); row.style.display = isTH ? 'grid':'none'; pr.required = !!isTH; if(!isTH) pr.value=''; }
  c.addEventListener('change', toggleProv);
  toggleProv();
});

// Visitor submit → Thank you
document.getElementById('visitor-form').addEventListener('submit', function(e){ e.preventDefault(); show('v2'); });
document.getElementById('to-staff').addEventListener('click', function(){ show('v3'); });

// Staff submit via fetch → Complete
document.getElementById('staff-form').addEventListener('submit', async function(e){
  e.preventDefault();
  var payload = {
    visitor: {
      email: document.getElementById('v-email').value.trim(),
      firstName: document.getElementById('v-first').value.trim(),
      lastName: document.getElementById('v-last').value.trim(),
      gender: document.getElementById('v-gender').value,
      ageRange: document.getElementById('v-age').value,
      country: document.getElementById('v-country').value,
      city: document.getElementById('v-city').value.trim(),
      thaiProvince: document.getElementById('v-province').value || '',
      source: document.getElementById('v-source').value,
      consent: document.getElementById('v-consent').checked
    },
    staff: {
      staffName: document.getElementById('s-staff').value,
      ticketType: document.getElementById('s-ticket').value,
      ticketQty: document.getElementById('s-qty').value,
      amountPaid: document.getElementById('s-amount').value,
      payMethod: (document.querySelector('input[name=pay]:checked')||{}).value || ''
    },
    submittedAt: new Date().toISOString()
  };

  var btn = document.getElementById('finalize');
  var old = btn.textContent; btn.textContent='กำลังส่ง...'; btn.disabled=true;

  try {
    var res = await fetch(FORMSPREE_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error('Formspree HTTP ' + res.status);
    show('v4');
  } catch (err) {
    console.error(err);
    alert('ส่งไม่สำเร็จ: ใช้ปุ่ม "ส่งแบบสำรอง (HTML POST)" ได้');
  } finally {
    btn.textContent = old; btn.disabled=false;
  }
});

// Fallback: pure HTML POST (no CORS)
document.getElementById('finalize-fallback').addEventListener('click', function(){
  var map = [
    ['f-submittedAt', new Date().toISOString()],
    ['f-v-email', document.getElementById('v-email').value.trim()],
    ['f-v-first', document.getElementById('v-first').value.trim()],
    ['f-v-last', document.getElementById('v-last').value.trim()],
    ['f-v-gender', document.getElementById('v-gender').value],
    ['f-v-age', document.getElementById('v-age').value],
    ['f-v-country', document.getElementById('v-country').value],
    ['f-v-city', document.getElementById('v-city').value.trim()],
    ['f-v-province', document.getElementById('v-province').value || ''],
    ['f-v-source', document.getElementById('v-source').value],
    ['f-v-consent', String(document.getElementById('v-consent').checked)],
    ['f-s-staff', document.getElementById('s-staff').value],
    ['f-s-ticket', document.getElementById('s-ticket').value],
    ['f-s-qty', document.getElementById('s-qty').value],
    ['f-s-amount', document.getElementById('s-amount').value],
    ['f-s-pay', (document.querySelector('input[name=pay]:checked')||{}).value || '']
  ];
  for (var k=0;k<map.length;k++){ document.getElementById(map[k][0]).value = map[k][1]; }
  document.getElementById('fallback-form').submit();
});

// Back to start
document.getElementById('back-to-start').addEventListener('click', function(){
  document.getElementById('visitor-form').reset();
  document.getElementById('staff-form').reset();
  // Rebuild select options
  var c = document.getElementById('v-country');
  var opts = '<option value="">— เลือกประเทศ —</option>';
  for (var i=0;i<COUNTRIES.length;i++){ opts += '<option>' + COUNTRIES[i] + '</option>'; }
  c.innerHTML = opts; c.value = 'Thailand';
  var pr = document.getElementById('v-province');
  var provOpts = '';
  for (var j=0;j<THAI_PROVINCES.length;j++){ provOpts += '<option>' + THAI_PROVINCES[j] + '</option>'; }
  pr.innerHTML = provOpts;
  document.getElementById('thai-province-row').style.display = 'grid';
  show('v1');
});
</script>
</body>
</html>
